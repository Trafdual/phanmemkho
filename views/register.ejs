<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <style>
        /* Your CSS styles here */
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
        }

        #register-container {
            width: 350px;
            margin: 0 auto;
            margin-top: 100px;
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            /* Align the content in the center */
        }
        #otp-container {
            width: 350px;
            margin: 0 auto;
            margin-top: 100px;
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            display: none;
            /* Align the content in the center */
        }

        .logo {
            margin-bottom: 20px;
            /* Adjust the margin as needed */
        }

        .logo img {
            max-width: 100%;
            height: auto;
        }

        input[type="text"],
        input[type="password"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        input[type="button"] {
            width: 100%;
            padding: 10px;
            border: 0;
            background: #2FF2FE;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        input[type="button"]:hover {
            background: #2c707f;
        }
        .no{
            display: none;
        }
    </style>
</head>

<body >

    <div id="register-container">
        <div class="logo">
            <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjYHobfZ2QjNopkNc0sfD5gRPq3PMAvhUEYL00SUdxZjdArv3XfDz9-YLh8A-DHgAjkpZDA8nzZpluI2V-aNg8sqH_R4TyThj9dqGIwXv-YCKOFe8c_xcggTiRWxmaazbatlNRrLzeOBJPlrGqxNuHJZRCce570KTVDJQgRlO64rsIV0yHSEFnbVoCYbWoZ/s320/anh.jpg"
                alt="Your App Logo">
        </div>
        <h2>Register</h2>
            <input type="text" placeholder="Họ và Tên" id="name" name="name" required><br>
            <input type="text" placeholder="Số Điện Thoại" id="phone" name="phone" required><br>
            <input type="text" placeholder="Email" id="email" name="email" required><br>
            <input type="text" placeholder="Password" id="password" name="password" required><br>
            <div id="recapcha" style="margin-top:5px"></div>
            <input type="button" value="Register" onclick="registerUser()">
    </div>
    <div id="otp-container">
        <h2>Nhập mã OTP</h2>
            <input type="text" placeholder="nhập mã OTP" id="otp" name="otp" required><br>
            <input type="button" value="Authentication" onclick="codeverify()">
            <div class="no alert alert-danger">OTP error</div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase.js"></script>

    <script>
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyAL6cp7X3vnIttif7XjWVZqnwomHdoxrRw",
            authDomain: "appgiapha.firebaseapp.com",
            projectId: "appgiapha",
            storageBucket: "appgiapha.appspot.com",
            messagingSenderId: "832803929271",
            appId: "1:832803929271:web:1453609f2cb23819c8e132",
            measurementId: "G-GLKHZPBEBY"
        };
        firebase.initializeApp(firebaseConfig);
        render();
        function render() {
            window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recapcha')
            recaptchaVerifier.render()
        }
        function phoneAuth() {
            var number = document.getElementById('phone').value;
            if (number.startsWith('0')) {
        number = '+84' + number.slice(1);
    }
            firebase.auth().signInWithPhoneNumber(number,
                window.recaptchaVerifier).then(function (confirmationResult) {
                    window.confirmationResult = confirmationResult;
                    coderesult = confirmationResult;
                    document.getElementById('otp-container').style.display='block';
                    document.getElementById('register-container').style.display='none';
                }).catch(function (error) {
                    alert(error.message)
                })

        }
        var userId;
        function registerUser() {
            var name = document.getElementById('name').value;
            var phone = document.getElementById('phone').value;
            var email = document.getElementById('email').value;
            var password = document.getElementById('password').value;

            $.ajax({
                url: '/register',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    name: name,
                    phone: phone,
                    email: email,
                    password: password
                }),
                success: function (response) {
                    userId = response.data.user[0]._id;
                    phoneAuth();
                },
                error: function (error) {
                    var errorResponse = JSON.parse(error.responseText);
                    console.log(errorResponse.error);
                }
            });
        }
function codeverify(){
    var code=document.getElementById('otp').value;
    coderesult.confirm(code).then(function(){
        $.ajax({
            url: '/register/' + userId,
            type: 'POST',
            success: function(response) {
                window.location.href = '/';
            },
            error: function(error) {
                var errorResponse = JSON.parse(error.responseText);
                    console.log(errorResponse.error);
            }
        });
        
    }).catch(function(){
        document.getElementsByClassName('no')[0].style.display='block';
    })
}
    </script>
</body>


</html>